import nmap
import xml.etree.ElementTree as ET

def scan_network(network):
    nm = nmap.PortScanner()
    nm.scan(network, arguments='-sV -oX scan_results.xml')
    return nm

def parse_results(xml_file):
    tree = ET.parse(xml_file)
    root = tree.getroot()
    results = []
    for host in root.findall('host'):
        ip = host.find('address').get('addr')
        for port in host.findall('.//port'):
            port_id = port.get('portid')
            service = port.find('service')
            if service is not None:
                service_name = service.get('name')
                service_version = service.get('version')
                results.append({
                    'ip': ip,
                    'port': port_id,
                    'service': service_name,
                    'version': service_version
                })
    return results